define("leaflet.vectorgrid",["leaflet"],function(t){"use strict";function e(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function i(t,e,i){var r,o,s=i.buf;if(o=s[i.pos++],r=(112&o)>>4,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<3,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<10,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<17,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<24,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(1&o)<<31,o<128)return n(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function r(t){return t.type===e.Bytes?t.readVarint()+t.pos:t.pos+1}function n(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function o(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),s(i,r,e),a(r,e)}function s(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}function a(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function u(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function h(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function _(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function w(t,e,i){for(var r="",n=e;n<i;){var o=t[n],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a>i)break;var u,h,l;1===a?o<128&&(s=o):2===a?128==(192&(u=t[n+1]))&&(s=(31&o)<<6|63&u)<=127&&(s=null):3===a?(u=t[n+1],h=t[n+2],128==(192&u)&&128==(192&h)&&((s=(15&o)<<12|(63&u)<<6|63&h)<=2047||s>=55296&&s<=57343)&&(s=null)):4===a&&(u=t[n+1],h=t[n+2],l=t[n+3],128==(192&u)&&128==(192&h)&&128==(192&l)&&((s=(15&o)<<18|(63&u)<<12|(63&h)<<6|63&l)<=65535||s>=1114112)&&(s=null)),null===s?(s=65533,a=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),r+=String.fromCharCode(s),n+=a}return r}function b(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}function P(t,e){this.x=t,this.y=e}function M(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(S,this,e)}function S(t,e,i){1==t?e.id=i.readVarint():2==t?F(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function F(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}function V(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=T(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}function T(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],i=t[s],r+=(i.x-e.x)*(e.y+i.y);return r}function k(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(B,this,e),this.length=this._features.length}function B(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(C(i))}function C(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}function z(t,e){this.layers=t.readFields(G,{},e)}function G(t,e,i){if(3===t){var r=new $(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}L.SVG.Tile=L.SVG.extend({initialize:function(t,e,i){L.SVG.prototype.initialize.call(this,i),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._container.setAttribute("viewBox",[0,0,this._size.x,this._size.y].join(" ")),this._layers={}},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},onAdd:L.Util.falseFn,addTo:function(t){if(this._map=t,this.options.interactive)for(var e in this._layers){var i=this._layers[e];i._path.style.pointerEvents="auto",this._map._targets[L.stamp(i._path)]=i}},removeFrom:function(t){if(this.options.interactive)for(var e in this._layers){var i=this._layers[e];delete this._map._targets[L.stamp(i._path)]}delete this._map},_initContainer:function(){L.SVG.prototype._initContainer.call(this);L.SVG.create("rect")},_addPath:function(t){this._rootGroup.appendChild(t._path),this._layers[L.stamp(t)]=t},_updateIcon:function(t){var e=t._path=L.SVG.create("image"),i=t.options.icon,r=i.options,n=L.point(r.iconSize),o=r.iconAnchor||n&&n.divideBy(2,!0),s=t._point.subtract(o);e.setAttribute("x",s.x),e.setAttribute("y",s.y),e.setAttribute("width",n.x+"px"),e.setAttribute("height",n.y+"px"),e.setAttribute("href",r.iconUrl)}}),L.svg.tile=function(t,e,i){return new L.SVG.Tile(t,e,i)};var A=L.Class.extend({render:function(t,e){this._renderer=t,this.options=e,t._initPath(this),t._updateStyle(this)},updateStyle:function(t,e){this.options=e,t._updateStyle(this)},_getPixelBounds:function(){for(var t=this._parts,e=L.bounds([]),i=0;i<t.length;i++)for(var r=t[i],n=0;n<r.length;n++)e.extend(r[n]);var o=this._clickTolerance(),s=new L.Point(o,o);return e.min._subtract(s),e.max._add(s),e},_clickTolerance:L.Path.prototype._clickTolerance}),I={_makeFeatureParts:function(t,e){var i,r=t.geometry;this._parts=[];for(var n=0;n<r.length;n++){for(var o=r[n],s=[],a=0;a<o.length;a++)i=o[a],s.push(L.point(i).scaleBy(e));this._parts.push(s)}},makeInteractive:function(){this._pxBounds=this._getPixelBounds()}},Y=L.CircleMarker.extend({includes:A.prototype,statics:{iconCache:{}},initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){A.prototype.render.call(this,t,e),this._radius=e.radius||L.CircleMarker.prototype.options.radius,this._updatePath()},_makeFeatureParts:function(t,e){var i=t.geometry[0];"object"==typeof i[0]&&"x"in i[0]?(this._point=L.point(i[0]).scaleBy(e),this._empty=L.Util.falseFn):(this._point=L.point(i).scaleBy(e),this._empty=L.Util.falseFn)},makeInteractive:function(){this._updateBounds()},updateStyle:function(t,e){return this._radius=e.radius||this._radius,this._updateBounds(),A.prototype.updateStyle.call(this,t,e)},_updateBounds:function(){var t=this.options.icon;if(t){var e=L.point(t.options.iconSize),i=t.options.iconAnchor||e&&e.divideBy(2,!0),r=this._point.subtract(i);this._pxBounds=new L.Bounds(r,r.add(t.options.iconSize))}else L.CircleMarker.prototype._updateBounds.call(this)},_updatePath:function(){this.options.icon?this._renderer._updateIcon(this):L.CircleMarker.prototype._updatePath.call(this)},_getImage:function(){if(this.options.icon){var t=this.options.icon.options.iconUrl,e=Y.iconCache[t];if(!e){var i=this.options.icon;e=Y.iconCache[t]=i.createIcon()}return e}return null},_containsPoint:function(t){return this.options.icon?this._pxBounds.contains(t):L.CircleMarker.prototype._containsPoint.call(this,t)}}),N=L.Polyline.extend({includes:[A.prototype,I],initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){e.fill=!1,A.prototype.render.call(this,t,e),this._updatePath()},updateStyle:function(t,e){e.fill=!1,A.prototype.updateStyle.call(this,t,e)}}),E=L.Polygon.extend({includes:[A.prototype,I],initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){A.prototype.render.call(this,t,e),this._updatePath()}});L.VectorGrid=L.GridLayer.extend({options:{rendererFactory:L.svg.tile,vectorTileLayerStyles:{},interactive:!1},initialize:function(t){L.setOptions(this,t),L.GridLayer.prototype.initialize.apply(this,arguments),this.options.getFeatureId&&(this._vectorTiles={},this._overriddenStyles={},this.on("tileunload",function(t){var e=this._tileCoordsToKey(t.coords),i=this._vectorTiles[e];i&&this._map&&i.removeFrom(this._map),delete this._vectorTiles[e]},this)),this._dataLayerNames={}},createTile:function(t,e){var i=this.options.getFeatureId,r=this.getTileSize(),n=this.options.rendererFactory(t,r,this.options),o=this._tileCoordsToBounds(t),s=this._getVectorTilePromise(t,o);return i&&(this._vectorTiles[this._tileCoordsToKey(t)]=n,n._features={}),s.then(function(r){if(r.layers&&0!==r.layers.length)for(var o in r.layers){this._dataLayerNames[o]=!0;for(var s=r.layers[o],a=this.getTileSize().divideBy(s.extent),u=this.options.vectorTileLayerStyles[o]||L.Path.prototype.options,h=0;h<s.features.length;h++){var l,f=s.features[h],c=u;if(i){l=this.options.getFeatureId(f);var p=this._overriddenStyles[l];p&&(c=p[o]?p[o]:p)}if(c instanceof Function&&(c=c(f.properties,t.z)),c instanceof Array||(c=[c]),c.length){for(var d=this._createLayer(f,a),g=0;g<c.length;g++){var v=L.extend({},L.Path.prototype.options,c[g]);d.render(n,v),n._addPath(d)}this.options.interactive&&d.makeInteractive(),i&&(n._features[l]={layerName:o,feature:d})}}}null!=this._map&&n.addTo(this._map),L.Util.requestAnimFrame(e.bind(t,null,null))}.bind(this)),n.getContainer()},setFeatureStyle:function(t,e){this._overriddenStyles[t]=e;for(var i in this._vectorTiles){var r=this._vectorTiles[i],n=r._features,o=n[t];if(o){var s=o.feature,a=e;e[o.layerName]&&(a=e[o.layerName]),this._updateStyles(s,r,a)}}return this},resetFeatureStyle:function(t){delete this._overriddenStyles[t];for(var e in this._vectorTiles){var i=this._vectorTiles[e],r=i._features,n=r[t];if(n){var o=n.feature,s=this.options.vectorTileLayerStyles[n.layerName]||L.Path.prototype.options;this._updateStyles(o,i,s)}}return this},getDataLayerNames:function(){return Object.keys(this._dataLayerNames)},_updateStyles:function(t,e,i){(i=i instanceof Function?i(t.properties,e.getCoord().z):i)instanceof Array||(i=[i]);for(var r=0;r<i.length;r++){var n=L.extend({},L.Path.prototype.options,i[r]);t.updateStyle(e,n)}},_createLayer:function(t,e,i){var r;switch(t.type){case 1:r=new Y(t,e);break;case 2:r=new N(t,e);break;case 3:r=new E(t,e)}return this.options.interactive&&r.addEventParent(this),r}}),L.vectorGrid=function(t){return new L.VectorGrid(t)};var X=function(t,e,i,r,n){var o,s,a=8*n-r-1,u=(1<<a)-1,h=u>>1,l=-7,f=i?n-1:0,c=i?-1:1,p=t[e+f];for(f+=c,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=c,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+t[e+f],f+=c,l-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=h}return(p?-1:1)*s*Math.pow(2,o-r)},j=function(t,e,i,r,n,o){var s,a,u,h=8*o-n-1,l=(1<<h)-1,f=l>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+f>=1?c/u:c*Math.pow(2,1-f),e*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,n),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=d,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[i+p]=255&s,p+=d,s/=256,h-=8);t[i+p-d]|=128*g},D={read:X,write:j},O=e,U=D;e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;e.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=m(this.buf,this.pos)+4294967296*x(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=U.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=U.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return r=n[this.pos++],e=127&r,r<128?e:(r=n[this.pos++],e|=(127&r)<<7,r<128?e:(r=n[this.pos++],e|=(127&r)<<14,r<128?e:(r=n[this.pos++],e|=(127&r)<<21,r<128?e:(r=n[this.pos],e|=(15&r)<<28,i(e,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=w(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===e.Varint)for(;this.buf[this.pos++]>127;);else if(i===e.Bytes)this.pos=this.readVarint()+this.pos;else if(i===e.Fixed32)this.pos+=4;else{if(i!==e.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0)return void o(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=b(this.buf,t,this.pos);var i=this.pos-e;i>=128&&u(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),U.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),U.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&u(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,r){this.writeTag(t,e.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(t,e){this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){this.writeMessage(t,l,e)},writePackedBoolean:function(t,e){this.writeMessage(t,p,e)},writePackedFloat:function(t,e){this.writeMessage(t,f,e)},writePackedDouble:function(t,e){this.writeMessage(t,c,e)},writePackedFixed32:function(t,e){this.writeMessage(t,d,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(t,i){this.writeTag(t,e.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,e.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,e.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,e.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Z=P;P.prototype={clone:function(){return new P(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(t){return t instanceof P?t:Array.isArray(t)?new P(t[0],t[1]):t};var q=Z,J=M;M.types=["Unknown","Point","LineString","Polygon"],M.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var u=t.readVarint();r=7&u,n=u>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new q(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},M.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<e;){if(r<=0){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)n+=t.readSVarint(),o+=t.readSVarint(),n<s&&(s=n),n>a&&(a=n),o<u&&(u=o),o>h&&(h=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,u,a,h]},M.prototype.toGeoJSON=function(t,e,i){function r(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+u)/s;t[e]=[360*(i.x+a)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}var n,o,s=this.extent*Math.pow(2,i),a=this.extent*t,u=this.extent*e,h=this.loadGeometry(),l=M.types[this.type];switch(this.type){case 1:var f=[];for(n=0;n<h.length;n++)f[n]=h[n][0];h=f,r(h);break;case 2:for(n=0;n<h.length;n++)r(h[n]);break;case 3:for(h=V(h),n=0;n<h.length;n++)for(o=0;o<h[n].length;o++)r(h[n][o])}1===h.length?h=h[0]:l="Multi"+l;var c={type:"Feature",geometry:{type:l,coordinates:h},properties:this.properties};return"id"in this&&(c.id=this.id),c};var R=J,W=k;k.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new R(this._pbf,e,this.extent,this._keys,this._values)};var $=W,K=z,H=K;L.VectorGrid.Protobuf=L.VectorGrid.extend({options:{subdomains:"abc",fetchOptions:{}},initialize:function(t,e){this._url=t,L.VectorGrid.prototype.initialize.call(this,e)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},_getSubdomain:L.TileLayer.prototype._getSubdomain,_isCurrentTile:function(t,e){if(!this._map)return!0;var i=this._map._animatingZoom?this._map._animateToZoom:this._map._zoom,r=i===t.z,e=this._tileCoordsToBounds(t),n=this._map.getBounds().overlaps(e);return r&&n},_getVectorTilePromise:function(t,e){var i={s:this._getSubdomain(t),x:t.x,y:t.y,z:t.z};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=r),i["-y"]=r}if(!this._isCurrentTile(t,e))return Promise.resolve({layers:[]});var n=L.Util.template(this._url,L.extend(i,this.options));return fetch(n,this.options.fetchOptions).then(function(e){return e.ok&&this._isCurrentTile(t)?e.blob().then(function(t){var e=new FileReader;return new Promise(function(i){e.addEventListener("loadend",function(){var t=new O(e.result);return i(new H(t))}),e.readAsArrayBuffer(t)})}):{layers:[]}}.bind(this)).then(function(t){for(var e in t.layers){for(var i=[],r=0;r<t.layers[e].length;r++){var n=t.layers[e].feature(r);n.geometry=n.loadGeometry(),i.push(n)}t.layers[e].features=i}return t})}}),L.vectorGrid.protobuf=function(t,e){return new L.VectorGrid.Protobuf(t,e)};var Q=function(t,e,i){try{return window.URL.createObjectURL(new Blob([Uint8Array.from(t.split("").map(function(t){return t.charCodeAt(0)}))],{type:e}))}catch(r){return"data:"+e+(i?";base64,":",")+t}
}('"use strict";function simplify(e,t,n,r){for(var i,o=r,s=n-t>>1,a=n-t,l=e[t],u=e[t+1],f=e[n],c=e[n+1],p=t+3;p<n;p+=3){var g=getSqSegDist(e[p],e[p+1],l,u,f,c);if(g>o)i=p,o=g;else if(g===o){var h=Math.abs(p-s);h<a&&(i=p,a=h)}}o>r&&(i-t>3&&simplify(e,t,i,r),e[i+2]=o,n-i>3&&simplify(e,i,n,r))}function getSqSegDist(e,t,n,r,i,o){var s=i-n,a=o-r;if(0!==s||0!==a){var l=((e-n)*s+(t-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return s=e-n,a=t-r,s*s+a*a}function createFeature(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return calcBBox(i),i}function calcBBox(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)calcLineBBox(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)calcLineBBox(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)calcLineBBox(e,t[r][i])}function calcLineBBox(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function convert(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)convertFeature(n,e.features[r],t,r);else"Feature"===e.type?convertFeature(n,e,t):convertFeature(n,{geometry:e},t);return n}function convertFeature(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===o)convertPoint(i,a);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)convertPoint(i[u],a);else if("LineString"===o)convertLine(i,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(u=0;u<i.length;u++)a=[],convertLine(i[u],a,s,!1),e.push(createFeature(l,"LineString",a,t.properties));return}convertLines(i,a,s,!1)}else if("Polygon"===o)convertLines(i,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<t.geometry.geometries.length;u++)convertFeature(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var f=[];convertLines(i[u],f,s,!0),a.push(f)}}e.push(createFeature(l,o,a,t.properties))}}function convertPoint(e,t){t.push(projectX(e[0])),t.push(projectY(e[1])),t.push(0)}function convertLine(e,t,n,r){for(var i,o,s=0,a=0;a<e.length;a++){var l=projectX(e[a][0]),u=projectY(e[a][1]);t.push(l),t.push(u),t.push(0),a>0&&(s+=r?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var f=t.length-3;t[2]=1,simplify(t,0,f,n),t[f+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function convertLines(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];convertLine(e[i],o,n,r),t.push(o)}}function projectX(e){return e/360+.5}function projectY(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function clip(e,t,n,r,i,o,s,a){if(n/=t,r/=t,o>=n&&s<r)return e;if(s<n||o>=r)return null;for(var l=[],u=0;u<e.length;u++){var f=e[u],c=f.geometry,p=f.type,g=0===i?f.minX:f.minY,h=0===i?f.maxX:f.maxY;if(g>=n&&h<r)l.push(f);else if(!(h<n||g>=r)){var m=[];if("Point"===p||"MultiPoint"===p)clipPoints(c,m,n,r,i);else if("LineString"===p)clipLine(c,m,n,r,i,!1,a.lineMetrics);else if("MultiLineString"===p)clipLines(c,m,n,r,i,!1);else if("Polygon"===p)clipLines(c,m,n,r,i,!0);else if("MultiPolygon"===p)for(var d=0;d<c.length;d++){var v=[];clipLines(c[d],v,n,r,i,!0),v.length&&m.push(v)}if(m.length){if(a.lineMetrics&&"LineString"===p){for(d=0;d<m.length;d++)l.push(createFeature(f.id,p,m[d],f.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(createFeature(f.id,p,m,f.tags))}}}return l.length?l:null}function clipPoints(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=n&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function clipLine(e,t,n,r,i,o,s){for(var a,l,u=newSlice(e),f=0===i?intersectX:intersectY,c=e.start,p=0;p<e.length-3;p+=3){var g=e[p],h=e[p+1],m=e[p+2],d=e[p+3],v=e[p+4],y=0===i?g:h,x=0===i?d:v,M=!1;s&&(a=Math.sqrt(Math.pow(g-d,2)+Math.pow(h-v,2))),y<n?x>n&&(l=f(u,g,h,d,v,n),s&&(u.start=c+a*l)):y>r?x<r&&(l=f(u,g,h,d,v,r),s&&(u.start=c+a*l)):addPoint(u,g,h,m),x<n&&y>=n&&(l=f(u,g,h,d,v,n),M=!0),x>r&&y<=r&&(l=f(u,g,h,d,v,r),M=!0),!o&&M&&(s&&(u.end=c+a*l),t.push(u),u=newSlice(e)),s&&(c+=a)}var P=e.length-3;g=e[P],h=e[P+1],m=e[P+2],y=0===i?g:h,y>=n&&y<=r&&addPoint(u,g,h,m),P=u.length-3,o&&P>=3&&(u[P]!==u[0]||u[P+1]!==u[1])&&addPoint(u,u[0],u[1],u[2]),u.length&&t.push(u)}function newSlice(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function clipLines(e,t,n,r,i,o){for(var s=0;s<e.length;s++)clipLine(e[s],t,n,r,i,o,!1)}function addPoint(e,t,n,r){e.push(t),e.push(n),e.push(r)}function intersectX(e,t,n,r,i,o){var s=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*s),e.push(1),s}function intersectY(e,t,n,r,i,o){var s=(o-n)/(i-n);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function wrap(e,t){var n=t.buffer/t.extent,r=e,i=clip(e,1,-1-n,n,0,-1,2,t),o=clip(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=clip(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=shiftFeatureCoords(i,1).concat(r)),o&&(r=r.concat(shiftFeatureCoords(o,-1)))),r}function shiftFeatureCoords(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=shiftCoords(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var a=0;a<o.geometry.length;a++)i.push(shiftCoords(o.geometry[a],t))}else if("MultiPolygon"===s)for(i=[],a=0;a<o.geometry.length;a++){for(var l=[],u=0;u<o.geometry[a].length;u++)l.push(shiftCoords(o.geometry[a][u],t));i.push(l)}n.push(createFeature(o.id,s,i,o.tags))}return n}function shiftCoords(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function transformTile(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],u=l.geometry,f=l.type;if(l.geometry=[],1===f)for(r=0;r<u.length;r+=2)l.geometry.push(transformPoint(u[r],u[r+1],t,o,s,a));else for(r=0;r<u.length;r++){var c=[];for(i=0;i<u[r].length;i+=2)c.push(transformPoint(u[r][i],u[r][i+1],t,o,s,a));l.geometry.push(c)}}return e.transformed=!0,e}function transformPoint(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function createTile(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,addFeature(s,e[a],o,i);var l=e[a].minX,u=e[a].minY,f=e[a].maxX,c=e[a].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),f>s.maxX&&(s.maxX=f),c>s.maxY&&(s.maxY=c)}return s}function addFeature(e,t,n,r){var i=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)addLine(s,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)addLine(s,i[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(a=0;a<u.length;a++)addLine(s,u[a],e,n,!0,0===a)}if(s.length){var f=t.tags||null;if("LineString"===o&&r.lineMetrics){f={};for(var c in t.tags)f[c]=t.tags[c];f.mapbox_clip_start=i.start/i.size,f.mapbox_clip_end=i.end/i.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:f};null!==t.id&&(p.id=t.id),e.features.push(p)}}function addLine(e,t,n,r,i,o){var s=r*r;if(r>0&&t.size<(i?s:r))return void(n.numPoints+=t.length/3);for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;i&&rewind(a,o),e.push(a)}function rewind(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=s,e[i-1-r]=a}}function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=convert(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=wrap(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,n){return 32*((1<<e)*n+t)+e}function extend(e,t){for(var n in t)e[n]=t[n];return e}function feature$1(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,o=object(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function object(e,t){function n(e,t){t.length&&t.pop();for(var n=u[e<0?~e:e],r=0,i=n.length;r<i;++r)t.push(l(n[r],r));e<0&&reverse(t,i)}function r(e){return l(e)}function i(e){for(var t=[],r=0,i=e.length;r<i;++r)n(e[r],t);return t.length<2&&t.push(t[0]),t}function o(e){for(var t=i(e);t.length<4;)t.push(t[0]);return t}function s(e){return e.map(o)}function a(e){var t,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(a)};case"Point":t=r(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(r);break;case"LineString":t=i(e.arcs);break;case"MultiLineString":t=e.arcs.map(i);break;case"Polygon":t=s(e.arcs);break;case"MultiPolygon":t=e.arcs.map(s);break;default:return null}return{type:n,coordinates:t}}var l=transform(e.transform),u=e.arcs;return a(t)}GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,n,r,i,o,s){for(var a=[e,t,n,r],l=this.options,u=l.debug;a.length;){r=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var f=1<<t,c=toID(t,n,r),p=this.tiles[c];if(!p&&(u>1&&console.time("creation"),p=this.tiles[c]=createTile(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var g="z"+t;this.stats[g]=(this.stats[g]||0)+1,this.total++}if(p.source=e,i){if(t===l.maxZoom||t===i)continue;var h=1<<i-t;if(n!==Math.floor(o/h)||r!==Math.floor(s/h))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){u>1&&console.time("clipping");var m,d,v,y,x,M,P=.5*l.buffer/l.extent,L=.5-P,S=.5+P,b=1+P;m=d=v=y=null,x=clip(e,f,n-P,n+S,0,p.minX,p.maxX,l),M=clip(e,f,n+L,n+b,0,p.minX,p.maxX,l),e=null,x&&(m=clip(x,f,r-P,r+S,1,p.minY,p.maxY,l),d=clip(x,f,r+L,r+b,1,p.minY,p.maxY,l),x=null),M&&(v=clip(M,f,r-P,r+S,1,p.minY,p.maxY,l),y=clip(M,f,r+L,r+b,1,p.minY,p.maxY,l),M=null),u>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*n,2*r),a.push(d||[],t+1,2*n,2*r+1),a.push(v||[],t+1,2*n+1,2*r),a.push(y||[],t+1,2*n+1,2*r+1)}}},GeoJSONVT.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var s=1<<e;t=(t%s+s)%s;var a=toID(e,t,n);if(this.tiles[a])return transformTile(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,u=e,f=t,c=n;!l&&u>0;)u--,f=Math.floor(f/2),c=Math.floor(c/2),l=this.tiles[toID(u,f,c)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,f,c),o>1&&console.time("drilling down"),this.splitTile(l.source,u,f,c,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?transformTile(this.tiles[a],i):null):null};var identity=function(e){return e},transform=function(e){if(null==e)return identity;var t,n,r=e.scale[0],i=e.scale[1],o=e.translate[0],s=e.translate[1];return function(e,a){a||(t=n=0);var l=2,u=e.length,f=new Array(u);for(f[0]=(t+=e[0])*r+o,f[1]=(n+=e[1])*i+s;l<u;)f[l]=e[l],++l;return f}},reverse=function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n},feature=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return feature$1(e,t)})}:feature$1(e,t)},bisect=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n},slicers={},options;onmessage=function(e){if("slice"===e.data[0]){var t=e.data[1];if(options=e.data[2],t.type&&"Topology"===t.type)for(var n in t.objects)slicers[n]=geojsonvt(feature(t,t.objects[n]),options);else slicers[options.vectorTileLayerName]=geojsonvt(t,options)}else if("get"===e.data[0]){var r=e.data[1],i={};for(var n in slicers){var o=slicers[n].getTile(r.z,r.x,r.y);if(o){var s={features:[],extent:options.extent,name:options.vectorTileLayerName,length:o.features.length};for(var a in o.features){var l={geometry:o.features[a].geometry,properties:o.features[a].tags,type:o.features[a].type};s.features.push(l)}i[n]=s}}postMessage({layers:i,coords:r})}};\n',"text/plain; charset=us-ascii",!1);L.VectorGrid.Slicer=L.VectorGrid.extend({options:{vectorTileLayerName:"sliced",extent:4096,maxZoom:14},initialize:function(t,e){L.VectorGrid.prototype.initialize.call(this,e);var e={};for(var i in this.options)"rendererFactory"!==i&&"vectorTileLayerStyles"!==i&&"function"!=typeof this.options[i]&&(e[i]=this.options[i]);this._worker=new Worker(Q),this._worker.postMessage(["slice",t,e])},_getVectorTilePromise:function(t){var e=this,i=new Promise(function(i){e._worker.addEventListener("message",function r(n){n.data.coords&&n.data.coords.x===t.x&&n.data.coords.y===t.y&&n.data.coords.z===t.z&&(i(n.data),e._worker.removeEventListener("message",r))})});return this._worker.postMessage(["get",t]),i}}),L.vectorGrid.slicer=function(t,e){return new L.VectorGrid.Slicer(t,e)},L.Canvas.Tile=L.Canvas.extend({initialize:function(t,e,i){L.Canvas.prototype.initialize.call(this,i),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._layers={},this._drawnLayers={},this._drawing=!0,i.interactive&&(this._container.style.pointerEvents="auto")},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},getOffset:function(){return this._tileCoord.scaleBy(this._size).subtract(this._map.getPixelOrigin())},onAdd:L.Util.falseFn,addTo:function(t){this._map=t},removeFrom:function(t){delete this._map},_onClick:function(t){var e,i,r=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());for(var n in this._layers)e=this._layers[n],e.options.interactive&&e._containsPoint(r)&&!this._map._draggableMoved(e)&&(i=e);i&&(L.DomEvent.fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());this._handleMouseHover(t,e)}},_updateIcon:function(t){if(this._drawing){var e=t.options.icon,i=e.options,r=L.point(i.iconSize),n=i.iconAnchor||r&&r.divideBy(2,!0),o=t._point.subtract(n),s=this._ctx,a=t._getImage();a.complete?s.drawImage(a,o.x,o.y,r.x,r.y):L.DomEvent.on(a,"load",function(){s.drawImage(a,o.x,o.y,r.x,r.y)}),this._drawnLayers[t._leaflet_id]=t}}}),L.canvas.tile=function(t,e,i){return new L.Canvas.Tile(t,e,i)}});
