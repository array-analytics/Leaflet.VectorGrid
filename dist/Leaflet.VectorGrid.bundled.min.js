!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define("leaflet-vectorgrid",e):e()}(0,function(){"use strict";function t(t){return t&&DataView.prototype.isPrototypeOf(t)}function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return $.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function s(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function a(t){var e=new FileReader,i=s(e);return e.readAsArrayBuffer(t),i}function u(t){var e=new FileReader,i=s(e);return e.readAsText(t),i}function h(t){for(var e=new Uint8Array(t),i=new Array(e.length),r=0;r<e.length;r++)i[r]=String.fromCharCode(e[r]);return i.join("")}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:$.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:$.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:$.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():$.arrayBuffer&&$.blob&&t(e)?(this._bodyArrayBuffer=l(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):$.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||tt(e))?this._bodyArrayBuffer=l(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):$.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},$.blob&&(this.blob=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},$.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function p(t){var e=t.toUpperCase();return et.indexOf(e)>-1?e:t}function c(t,e){e=e||{};var i=e.body;if(t instanceof c){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=p(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function d(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(n))}}),e}function y(t){var e=new n;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var i=t.split(":"),r=i.shift().trim();if(r){var n=i.join(":").trim();e.append(r,n)}}),e}function g(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new n(e.headers),this.url=e.url||"",this._initBody(t)}function m(t,e){return new Promise(function(i,r){function n(){s.abort()}var o=new c(t,e);if(o.signal&&o.signal.aborted)return r(new rt("Aborted","AbortError"));var s=new XMLHttpRequest;s.onload=function(){var t={status:s.status,statusText:s.statusText,headers:y(s.getAllResponseHeaders()||"")};t.url="responseURL"in s?s.responseURL:t.headers.get("X-Request-URL");var e="response"in s?s.response:s.responseText;i(new g(e,t))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.onabort=function(){r(new rt("Aborted","AbortError"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&$.blob&&(s.responseType="blob"),o.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),o.signal&&(o.signal.addEventListener("abort",n),s.onreadystatechange=function(){4===s.readyState&&o.signal.removeEventListener("abort",n)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})}function v(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function _(t,e,i){var r,n,o=i.buf;if(n=o[i.pos++],r=(112&n)>>4,n<128)return x(t,r,e);if(n=o[i.pos++],r|=(127&n)<<3,n<128)return x(t,r,e);if(n=o[i.pos++],r|=(127&n)<<10,n<128)return x(t,r,e);if(n=o[i.pos++],r|=(127&n)<<17,n<128)return x(t,r,e);if(n=o[i.pos++],r|=(127&n)<<24,n<128)return x(t,r,e);if(n=o[i.pos++],r|=(1&n)<<31,n<128)return x(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function b(t){return t.type===v.Bytes?t.readVarint()+t.pos:t.pos+1}function x(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function w(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),P(i,r,e),M(r,e)}function P(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}function M(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function S(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function F(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function T(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function B(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function V(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function k(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function A(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function E(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function C(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function z(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function I(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function O(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function U(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function G(t,e,i){for(var r="",n=e;n<i;){var o=t[n],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a>i)break;var u,h,l;1===a?o<128&&(s=o):2===a?128==(192&(u=t[n+1]))&&(s=(31&o)<<6|63&u)<=127&&(s=null):3===a?(u=t[n+1],h=t[n+2],128==(192&u)&&128==(192&h)&&((s=(15&o)<<12|(63&u)<<6|63&h)<=2047||s>=55296&&s<=57343)&&(s=null)):4===a&&(u=t[n+1],h=t[n+2],l=t[n+3],128==(192&u)&&128==(192&h)&&128==(192&l)&&((s=(15&o)<<18|(63&u)<<12|(63&h)<<6|63&l)<=65535||s>=1114112)&&(s=null)),null===s?(s=65533,a=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),r+=String.fromCharCode(s),n+=a}return r}function Y(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}function j(t,e){this.x=t,this.y=e}function D(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(N,this,e)}function N(t,e,i){1==t?e.id=i.readVarint():2==t?X(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function X(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}function R(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=Z(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}function Z(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],i=t[s],r+=(i.x-e.x)*(e.y+i.y);return r}function q(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(H,this,e),this.length=this._features.length}function H(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(J(i))}function J(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}function W(t,e){this.layers=t.readFields(K,{},e)}function K(t,e,i){if(3===t){var r=new dt(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var $={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if($.arrayBuffer)var Q=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],tt=ArrayBuffer.isView||function(t){return t&&Q.indexOf(Object.prototype.toString.call(t))>-1};n.prototype.append=function(t,r){t=e(t),r=i(r);var n=this.map[t];this.map[t]=n?n+", "+r:r},n.prototype.delete=function(t){delete this.map[e(t)]},n.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,r){this.map[e(t)]=i(r)},n.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),r(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),r(t)},$.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var et=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this,{body:this._bodyInit})},f.call(c.prototype),f.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},g.error=function(){var t=new g(null,{status:0,statusText:""});return t.type="error",t};var it=[301,302,303,307,308];g.redirect=function(t,e){if(-1===it.indexOf(e))throw new RangeError("Invalid status code");return new g(null,{status:e,headers:{location:t}})};var rt=self.DOMException;try{new rt}catch(t){rt=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack},rt.prototype=Object.create(Error.prototype),rt.prototype.constructor=rt}m.polyfill=!0,self.fetch||(self.fetch=m,self.Headers=n,self.Request=c,self.Response=g);var nt=function(t,e,i,r,n){var o,s,a=8*n-r-1,u=(1<<a)-1,h=u>>1,l=-7,f=i?n-1:0,p=i?-1:1,c=t[e+f];for(f+=p,o=c&(1<<-l)-1,c>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=p,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+t[e+f],f+=p,l-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(c?-1:1);s+=Math.pow(2,r),o-=h}return(c?-1:1)*s*Math.pow(2,o-r)},ot=function(t,e,i,r,n,o){var s,a,u,h=8*o-n-1,l=(1<<h)-1,f=l>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:o-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+f>=1?p/u:p*Math.pow(2,1-f),e*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,n),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,n),s=0));n>=8;t[i+c]=255&a,c+=d,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[i+c]=255&s,c+=d,s/=256,h-=8);t[i+c-d]|=128*y},st={read:nt,write:ot},at=v,ut=st;v.Varint=0,v.Fixed64=1,v.Bytes=2,v.Fixed32=5;v.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=I(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=U(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=I(this.buf,this.pos)+4294967296*I(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=I(this.buf,this.pos)+4294967296*U(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ut.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ut.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return i=r[this.pos++],e=127&i,i<128?e:(i=r[this.pos++],e|=(127&i)<<7,i<128?e:(i=r[this.pos++],e|=(127&i)<<14,i<128?e:(i=r[this.pos++],e|=(127&i)<<21,i<128?e:(i=r[this.pos],e|=(15&i)<<28,_(e,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=G(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=b(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===v.Varint)for(;this.buf[this.pos++]>127;);else if(e===v.Bytes)this.pos=this.readVarint()+this.pos;else if(e===v.Fixed32)this.pos+=4;else{if(e!==v.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),O(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),O(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),O(this.buf,-1&t,this.pos),O(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),O(this.buf,-1&t,this.pos),O(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0)return void w(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=Y(this.buf,t,this.pos);var i=this.pos-e;i>=128&&S(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ut.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ut.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&S(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,v.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,F,e)},writePackedSVarint:function(t,e){this.writeMessage(t,T,e)},writePackedBoolean:function(t,e){this.writeMessage(t,k,e)},writePackedFloat:function(t,e){this.writeMessage(t,B,e)},writePackedDouble:function(t,e){this.writeMessage(t,V,e)},writePackedFixed32:function(t,e){this.writeMessage(t,A,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,E,e)},writePackedFixed64:function(t,e){this.writeMessage(t,C,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,z,e)},writeBytesField:function(t,e){this.writeTag(t,v.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,v.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,v.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,v.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,v.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,v.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,v.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,v.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,v.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,v.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var ht=j;j.prototype={clone:function(){return new j(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(t){return t instanceof j?t:Array.isArray(t)?new j(t[0],t[1]):t};var lt=ht,ft=D;D.types=["Unknown","Point","LineString","Polygon"],D.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var u=t.readVarint();r=7&u,n=u>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new lt(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},D.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<e;){if(r<=0){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)n+=t.readSVarint(),o+=t.readSVarint(),n<s&&(s=n),n>a&&(a=n),o<u&&(u=o),o>h&&(h=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,u,a,h]},D.prototype.toGeoJSON=function(t,e,i){function r(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+u)/s;t[e]=[360*(i.x+a)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}var n,o,s=this.extent*Math.pow(2,i),a=this.extent*t,u=this.extent*e,h=this.loadGeometry(),l=D.types[this.type];switch(this.type){case 1:var f=[];for(n=0;n<h.length;n++)f[n]=h[n][0];h=f,r(h);break;case 2:for(n=0;n<h.length;n++)r(h[n]);break;case 3:for(h=R(h),n=0;n<h.length;n++)for(o=0;o<h[n].length;o++)r(h[n][o])}1===h.length?h=h[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p};var pt=ft,ct=q;q.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new pt(this._pbf,e,this.extent,this._keys,this._values)};var dt=ct,yt=W,gt=yt;L.SVG.Tile=L.SVG.extend({initialize:function(t,e,i){L.SVG.prototype.initialize.call(this,i),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._container.setAttribute("viewBox",[0,0,this._size.x,this._size.y].join(" ")),this._layers={}},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},onAdd:L.Util.falseFn,addTo:function(t){if(this._map=t,this.options.interactive)for(var e in this._layers){var i=this._layers[e];i._path.style.pointerEvents="auto",this._map._targets[L.stamp(i._path)]=i}},removeFrom:function(t){if(this.options.interactive)for(var e in this._layers){var i=this._layers[e];delete this._map._targets[L.stamp(i._path)]}delete this._map},_initContainer:function(){L.SVG.prototype._initContainer.call(this);L.SVG.create("rect")},_addPath:function(t){this._rootGroup.appendChild(t._path),this._layers[L.stamp(t)]=t},_updateIcon:function(t){var e=t._path=L.SVG.create("image"),i=t.options.icon,r=i.options,n=L.point(r.iconSize),o=r.iconAnchor||n&&n.divideBy(2,!0),s=t._point.subtract(o);e.setAttribute("x",s.x),e.setAttribute("y",s.y),e.setAttribute("width",n.x+"px"),e.setAttribute("height",n.y+"px"),e.setAttribute("href",r.iconUrl)}}),L.svg.tile=function(t,e,i){return new L.SVG.Tile(t,e,i)};var mt=L.Class.extend({render:function(t,e){this._renderer=t,this.options=e,t._initPath(this),t._updateStyle(this)},updateStyle:function(t,e){this.options=e,t._updateStyle(this)},_getPixelBounds:function(){for(var t=this._parts,e=L.bounds([]),i=0;i<t.length;i++)for(var r=t[i],n=0;n<r.length;n++)e.extend(r[n]);var o=this._clickTolerance(),s=new L.Point(o,o);return e.min._subtract(s),e.max._add(s),e},_clickTolerance:L.Path.prototype._clickTolerance}),vt={_makeFeatureParts:function(t,e){var i,r=t.geometry;this._parts=[];for(var n=0;n<r.length;n++){for(var o=r[n],s=[],a=0;a<o.length;a++)i=o[a],s.push(L.point(i).scaleBy(e));this._parts.push(s)}},makeInteractive:function(){this._pxBounds=this._getPixelBounds()}},_t=L.CircleMarker.extend({includes:mt.prototype,statics:{iconCache:{}},initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){mt.prototype.render.call(this,t,e),this._radius=e.radius||L.CircleMarker.prototype.options.radius,this._updatePath()},_makeFeatureParts:function(t,e){var i=t.geometry[0];"object"==typeof i[0]&&"x"in i[0]?(this._point=L.point(i[0]).scaleBy(e),this._empty=L.Util.falseFn):(this._point=L.point(i).scaleBy(e),this._empty=L.Util.falseFn)},makeInteractive:function(){this._updateBounds()},updateStyle:function(t,e){return this._radius=e.radius||this._radius,this._updateBounds(),mt.prototype.updateStyle.call(this,t,e)},_updateBounds:function(){var t=this.options.icon;if(t){var e=L.point(t.options.iconSize),i=t.options.iconAnchor||e&&e.divideBy(2,!0),r=this._point.subtract(i);this._pxBounds=new L.Bounds(r,r.add(t.options.iconSize))}else L.CircleMarker.prototype._updateBounds.call(this)},_updatePath:function(){this.options.icon?this._renderer._updateIcon(this):L.CircleMarker.prototype._updatePath.call(this)},_getImage:function(){if(this.options.icon){var t=this.options.icon.options.iconUrl,e=_t.iconCache[t];if(!e){var i=this.options.icon;e=_t.iconCache[t]=i.createIcon()}return e}return null},_containsPoint:function(t){return this.options.icon?this._pxBounds.contains(t):L.CircleMarker.prototype._containsPoint.call(this,t)}}),bt=L.Polyline.extend({includes:[mt.prototype,vt],initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){e.fill=!1,mt.prototype.render.call(this,t,e),this._updatePath()},updateStyle:function(t,e){e.fill=!1,mt.prototype.updateStyle.call(this,t,e)}}),xt=L.Polygon.extend({includes:[mt.prototype,vt],initialize:function(t,e){this.properties=t.properties,this._makeFeatureParts(t,e)},render:function(t,e){mt.prototype.render.call(this,t,e),this._updatePath()}});L.VectorGrid=L.GridLayer.extend({options:{rendererFactory:L.svg.tile,vectorTileLayerStyles:{},interactive:!1},initialize:function(t){L.setOptions(this,t),L.GridLayer.prototype.initialize.apply(this,arguments),this.options.getFeatureId&&(this._vectorTiles={},this._overriddenStyles={},this.on("tileunload",function(t){var e=this._tileCoordsToKey(t.coords),i=this._vectorTiles[e];i&&this._map&&i.removeFrom(this._map),delete this._vectorTiles[e]},this)),this._dataLayerNames={}},createTile:function(t,e){var i=this.options.getFeatureId,r=this.getTileSize(),n=this.options.rendererFactory(t,r,this.options),o=this._tileCoordsToBounds(t),s=this._getVectorTilePromise(t,o);return i&&(this._vectorTiles[this._tileCoordsToKey(t)]=n,n._features={}),s.then(function(r){if(r.layers&&0!==r.layers.length)for(var o in r.layers){this._dataLayerNames[o]=!0;for(var s=r.layers[o],a=this.getTileSize().divideBy(s.extent),u=this.options.vectorTileLayerStyles[o]||L.Path.prototype.options,h=0;h<s.features.length;h++){var l,f=s.features[h],p=u;if(i){l=this.options.getFeatureId(f);var c=this._overriddenStyles[l];c&&(p=c[o]?c[o]:c)}if(p instanceof Function&&(p=p(f.properties,t.z)),p instanceof Array||(p=[p]),p.length){for(var d=this._createLayer(f,a),y=0;y<p.length;y++){var g=L.extend({},L.Path.prototype.options,p[y]);d.render(n,g),n._addPath(d)}this.options.interactive&&d.makeInteractive(),i&&(n._features[l]={layerName:o,feature:d})}}}null!=this._map&&n.addTo(this._map),L.Util.requestAnimFrame(e.bind(t,null,null))}.bind(this)),n.getContainer()},setFeatureStyle:function(t,e){this._overriddenStyles[t]=e;for(var i in this._vectorTiles){var r=this._vectorTiles[i],n=r._features,o=n[t];if(o){var s=o.feature,a=e;e[o.layerName]&&(a=e[o.layerName]),this._updateStyles(s,r,a)}}return this},resetFeatureStyle:function(t){delete this._overriddenStyles[t];for(var e in this._vectorTiles){var i=this._vectorTiles[e],r=i._features,n=r[t];if(n){var o=n.feature,s=this.options.vectorTileLayerStyles[n.layerName]||L.Path.prototype.options;this._updateStyles(o,i,s)}}return this},getDataLayerNames:function(){return Object.keys(this._dataLayerNames)},_updateStyles:function(t,e,i){(i=i instanceof Function?i(t.properties,e.getCoord().z):i)instanceof Array||(i=[i]);for(var r=0;r<i.length;r++){var n=L.extend({},L.Path.prototype.options,i[r]);t.updateStyle(e,n)}},_createLayer:function(t,e,i){var r;switch(t.type){case 1:r=new _t(t,e);break;case 2:r=new bt(t,e);break;case 3:r=new xt(t,e)}return this.options.interactive&&r.addEventParent(this),r}}),L.vectorGrid=function(t){return new L.VectorGrid(t)},L.VectorGrid.Protobuf=L.VectorGrid.extend({options:{subdomains:"abc",fetchOptions:{}},initialize:function(t,e){this._url=t,L.VectorGrid.prototype.initialize.call(this,e)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},_getSubdomain:L.TileLayer.prototype._getSubdomain,_isCurrentTile:function(t,e){if(!this._map)return!0;var i=this._map._animatingZoom?this._map._animateToZoom:this._map._zoom,r=i===t.z,e=this._tileCoordsToBounds(t),n=this._map.getBounds().overlaps(e);return r&&n},_getVectorTilePromise:function(t,e){var i={s:this._getSubdomain(t),x:t.x,y:t.y,z:t.z};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=r),i["-y"]=r}if(!this._isCurrentTile(t,e))return Promise.resolve({layers:[]});var n=L.Util.template(this._url,L.extend(i,this.options));return fetch(n,this.options.fetchOptions).then(function(e){return e.ok&&this._isCurrentTile(t)?e.blob().then(function(t){var e=new FileReader;return new Promise(function(i){e.addEventListener("loadend",function(){var t=new at(e.result);return i(new gt(t))}),e.readAsArrayBuffer(t)})}):{layers:[]}}.bind(this)).then(function(t){for(var e in t.layers){for(var i=[],r=0;r<t.layers[e].length;r++){var n=t.layers[e].feature(r);n.geometry=n.loadGeometry(),i.push(n)}t.layers[e].features=i}return t})}}),L.vectorGrid.protobuf=function(t,e){return new L.VectorGrid.Protobuf(t,e)};var wt=function(t,e,i){try{return window.URL.createObjectURL(new Blob([Uint8Array.from(t.split("").map(function(t){return t.charCodeAt(0)}))],{type:e}))}catch(r){return"data:"+e+(i?";base64,":",")+t}
}('!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define("leaflet-vectorgrid-ww",t):t()}(0,function(){"use strict";function e(n,r,i,o){for(var a,s=o,l=i-r>>1,u=i-r,f=n[r],g=n[r+1],h=n[i],p=n[i+1],m=r+3;m<i;m+=3){var c=t(n[m],n[m+1],f,g,h,p);if(c>s)a=m,s=c;else if(c===s){var d=Math.abs(m-l);d<u&&(a=m,u=d)}}s>o&&(a-r>3&&e(n,r,a,o),n[a+2]=s,i-a>3&&e(n,a,i,o))}function t(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var l=((e-n)*a+(t-r)*s)/(a*a+s*s);l>1?(n=i,r=o):l>0&&(n+=a*l,r+=s*l)}return a=e-n,s=t-r,a*a+s*s}function n(e,t,n,i){var o={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return r(o),o}function r(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)i(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)i(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)i(e,t[r][o])}function i(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function o(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)a(n,e.features[r],t,r);else"Feature"===e.type?a(n,e,t):a(n,{geometry:e},t);return n}function a(e,t,r,i){if(t.geometry){var o=t.geometry.coordinates,f=t.geometry.type,g=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),h=[],p=t.id;if(r.promoteId?p=t.properties[r.promoteId]:r.generateId&&(p=i||0),"Point"===f)s(o,h);else if("MultiPoint"===f)for(var m=0;m<o.length;m++)s(o[m],h);else if("LineString"===f)l(o,h,g,!1);else if("MultiLineString"===f){if(r.lineMetrics){for(m=0;m<o.length;m++)h=[],l(o[m],h,g,!1),e.push(n(p,"LineString",h,t.properties));return}u(o,h,g,!1)}else if("Polygon"===f)u(o,h,g,!0);else{if("MultiPolygon"!==f){if("GeometryCollection"===f){for(m=0;m<t.geometry.geometries.length;m++)a(e,{id:p,geometry:t.geometry.geometries[m],properties:t.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(m=0;m<o.length;m++){var c=[];u(o[m],c,g,!0),h.push(c)}}e.push(n(p,f,h,t.properties))}}function s(e,t){t.push(f(e[0])),t.push(g(e[1])),t.push(0)}function l(t,n,r,i){for(var o,a,s=0,l=0;l<t.length;l++){var u=f(t[l][0]),h=g(t[l][1]);n.push(u),n.push(h),n.push(0),l>0&&(s+=i?(o*h-u*a)/2:Math.sqrt(Math.pow(u-o,2)+Math.pow(h-a,2))),o=u,a=h}var p=n.length-3;n[2]=1,e(n,0,p,r),n[p+2]=1,n.size=Math.abs(s),n.start=0,n.end=n.size}function u(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];l(e[i],o,n,r),t.push(o)}}function f(e){return e/360+.5}function g(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function h(e,t,r,i,o,a,s,l){if(r/=t,i/=t,a>=r&&s<i)return e;if(s<r||a>=i)return null;for(var u=[],f=0;f<e.length;f++){var g=e[f],h=g.geometry,c=g.type,v=0===o?g.minX:g.minY,y=0===o?g.maxX:g.maxY;if(v>=r&&y<i)u.push(g);else if(!(y<r||v>=i)){var x=[];if("Point"===c||"MultiPoint"===c)p(h,x,r,i,o);else if("LineString"===c)m(h,x,r,i,o,!1,l.lineMetrics);else if("MultiLineString"===c)d(h,x,r,i,o,!1);else if("Polygon"===c)d(h,x,r,i,o,!0);else if("MultiPolygon"===c)for(var M=0;M<h.length;M++){var P=[];d(h[M],P,r,i,o,!0),P.length&&x.push(P)}if(x.length){if(l.lineMetrics&&"LineString"===c){for(M=0;M<x.length;M++)u.push(n(g.id,c,x[M],g.tags));continue}"LineString"!==c&&"MultiLineString"!==c||(1===x.length?(c="LineString",x=x[0]):c="MultiLineString"),"Point"!==c&&"MultiPoint"!==c||(c=3===x.length?"Point":"MultiPoint"),u.push(n(g.id,c,x,g.tags))}}}return u.length?u:null}function p(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function m(e,t,n,r,i,o,a){for(var s,l,u=c(e),f=0===i?y:x,g=e.start,h=0;h<e.length-3;h+=3){var p=e[h],m=e[h+1],d=e[h+2],M=e[h+3],P=e[h+4],b=0===i?p:m,S=0===i?M:P,Y=!1;a&&(s=Math.sqrt(Math.pow(p-M,2)+Math.pow(m-P,2))),b<n?S>n&&(l=f(u,p,m,M,P,n),a&&(u.start=g+s*l)):b>r?S<r&&(l=f(u,p,m,M,P,r),a&&(u.start=g+s*l)):v(u,p,m,d),S<n&&b>=n&&(l=f(u,p,m,M,P,n),Y=!0),S>r&&b<=r&&(l=f(u,p,m,M,P,r),Y=!0),!o&&Y&&(a&&(u.end=g+s*l),t.push(u),u=c(e)),a&&(g+=s)}var L=e.length-3;p=e[L],m=e[L+1],d=e[L+2],b=0===i?p:m,b>=n&&b<=r&&v(u,p,m,d),L=u.length-3,o&&L>=3&&(u[L]!==u[0]||u[L+1]!==u[1])&&v(u,u[0],u[1],u[2]),u.length&&t.push(u)}function c(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function d(e,t,n,r,i,o){for(var a=0;a<e.length;a++)m(e[a],t,n,r,i,o,!1)}function v(e,t,n,r){e.push(t),e.push(n),e.push(r)}function y(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function x(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function M(e,t){var n=t.buffer/t.extent,r=e,i=h(e,1,-1-n,n,0,-1,2,t),o=h(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=h(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=P(i,1).concat(r)),o&&(r=r.concat(P(o,-1)))),r}function P(e,t){for(var r=[],i=0;i<e.length;i++){var o,a=e[i],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=b(a.geometry,t);else if("MultiLineString"===s||"Polygon"===s){o=[];for(var l=0;l<a.geometry.length;l++)o.push(b(a.geometry[l],t))}else if("MultiPolygon"===s)for(o=[],l=0;l<a.geometry.length;l++){for(var u=[],f=0;f<a.geometry[l].length;f++)u.push(b(a.geometry[l][f],t));o.push(u)}r.push(n(a.id,s,o,a.tags))}return r}function b(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function S(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],u=l.geometry,f=l.type;if(l.geometry=[],1===f)for(r=0;r<u.length;r+=2)l.geometry.push(Y(u[r],u[r+1],t,o,a,s));else for(r=0;r<u.length;r++){var g=[];for(i=0;i<u[r].length;i+=2)g.push(Y(u[r][i],u[r][i+1],t,o,a,s));l.geometry.push(g)}}return e.transformed=!0,e}function Y(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function L(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,X(a,e[s],o,i);var l=e[s].minX,u=e[s].minY,f=e[s].maxX,g=e[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),f>a.maxX&&(a.maxX=f),g>a.maxY&&(a.maxY=g)}return a}function X(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)w(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)w(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)w(a,u[s],e,n,!0,0===s)}if(a.length){var f=t.tags||null;if("LineString"===o&&r.lineMetrics){f={};for(var g in t.tags)f[g]=t.tags[g];f.mapbox_clip_start=i.start/i.size,f.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:f};null!==t.id&&(h.id=t.id),e.features.push(h)}}function w(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))return void(n.numPoints+=t.length/3);for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>a)&&(n.numSimplified++,s.push(t[l]),s.push(t[l+1])),n.numPoints++;i&&z(s,o),e.push(s)}function z(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}function I(e,t){return new Z(e,t)}function Z(e,t){t=this.options=E(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=o(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=M(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function F(e,t,n){return 32*((1<<e)*n+t)+e}function E(e,t){for(var n in t)e[n]=t[n];return e}function T(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,o=C(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function C(e,t){function n(e,t){t.length&&t.pop();for(var n=u[e<0?~e:e],r=0,i=n.length;r<i;++r)t.push(l(n[r],r));e<0&&N(t,i)}function r(e){return l(e)}function i(e){for(var t=[],r=0,i=e.length;r<i;++r)n(e[r],t);return t.length<2&&t.push(t[0]),t}function o(e){for(var t=i(e);t.length<4;)t.push(t[0]);return t}function a(e){return e.map(o)}function s(e){var t,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(s)};case"Point":t=r(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(r);break;case"LineString":t=i(e.arcs);break;case"MultiLineString":t=e.arcs.map(i);break;case"Polygon":t=a(e.arcs);break;case"MultiPolygon":t=e.arcs.map(a);break;default:return null}return{type:n,coordinates:t}}var l=G(e.transform),u=e.arcs;return s(t)}Z.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Z.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],l=this.options,u=l.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var f=1<<t,g=F(t,n,r),p=this.tiles[g];if(!p&&(u>1&&console.time("creation"),p=this.tiles[g]=L(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var m="z"+t;this.stats[m]=(this.stats[m]||0)+1,this.total++}if(p.source=e,i){if(t===l.maxZoom||t===i)continue;var c=1<<i-t;if(n!==Math.floor(o/c)||r!==Math.floor(a/c))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){u>1&&console.time("clipping");var d,v,y,x,M,P,b=.5*l.buffer/l.extent,S=.5-b,Y=.5+b,X=1+b;d=v=y=x=null,M=h(e,f,n-b,n+Y,0,p.minX,p.maxX,l),P=h(e,f,n+S,n+X,0,p.minX,p.maxX,l),e=null,M&&(d=h(M,f,r-b,r+Y,1,p.minY,p.maxY,l),v=h(M,f,r+S,r+X,1,p.minY,p.maxY,l),M=null),P&&(y=h(P,f,r-b,r+Y,1,p.minY,p.maxY,l),x=h(P,f,r+S,r+X,1,p.minY,p.maxY,l),P=null),u>1&&console.timeEnd("clipping"),s.push(d||[],t+1,2*n,2*r),s.push(v||[],t+1,2*n,2*r+1),s.push(y||[],t+1,2*n+1,2*r),s.push(x||[],t+1,2*n+1,2*r+1)}}},Z.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e;t=(t%a+a)%a;var s=F(e,t,n);if(this.tiles[s])return S(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,u=e,f=t,g=n;!l&&u>0;)u--,f=Math.floor(f/2),g=Math.floor(g/2),l=this.tiles[F(u,f,g)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,f,g),o>1&&console.time("drilling down"),this.splitTile(l.source,u,f,g,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?S(this.tiles[s],i):null):null};var k,j=function(e){return e},G=function(e){if(null==e)return j;var t,n,r=e.scale[0],i=e.scale[1],o=e.translate[0],a=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,f=new Array(u);for(f[0]=(t+=e[0])*r+o,f[1]=(n+=e[1])*i+a;l<u;)f[l]=e[l],++l;return f}},N=function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n},_=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return T(e,t)})}:T(e,t)},O={};onmessage=function(e){if("slice"===e.data[0]){var t=e.data[1];if(k=e.data[2],t.type&&"Topology"===t.type)for(var n in t.objects)O[n]=I(_(t,t.objects[n]),k);else O[k.vectorTileLayerName]=I(t,k)}else if("get"===e.data[0]){var r=e.data[1],i={};for(var n in O){var o=O[n].getTile(r.z,r.x,r.y);if(o){var a={features:[],extent:k.extent,name:k.vectorTileLayerName,length:o.features.length};for(var s in o.features){var l={geometry:o.features[s].geometry,properties:o.features[s].tags,type:o.features[s].type};a.features.push(l)}i[n]=a}}postMessage({layers:i,coords:r})}}});\n',"text/plain; charset=us-ascii",!1);L.VectorGrid.Slicer=L.VectorGrid.extend({options:{vectorTileLayerName:"sliced",extent:4096,maxZoom:14},initialize:function(t,e){L.VectorGrid.prototype.initialize.call(this,e);var e={};for(var i in this.options)"rendererFactory"!==i&&"vectorTileLayerStyles"!==i&&"function"!=typeof this.options[i]&&(e[i]=this.options[i]);this._worker=new Worker(wt),this._worker.postMessage(["slice",t,e])},_getVectorTilePromise:function(t){var e=this,i=new Promise(function(i){e._worker.addEventListener("message",function r(n){n.data.coords&&n.data.coords.x===t.x&&n.data.coords.y===t.y&&n.data.coords.z===t.z&&(i(n.data),e._worker.removeEventListener("message",r))})});return this._worker.postMessage(["get",t]),i}}),L.vectorGrid.slicer=function(t,e){return new L.VectorGrid.Slicer(t,e)},L.Canvas.Tile=L.Canvas.extend({initialize:function(t,e,i){L.Canvas.prototype.initialize.call(this,i),this._tileCoord=t,this._size=e,this._initContainer(),this._container.setAttribute("width",this._size.x),this._container.setAttribute("height",this._size.y),this._layers={},this._drawnLayers={},this._drawing=!0,i.interactive&&(this._container.style.pointerEvents="auto")},getCoord:function(){return this._tileCoord},getContainer:function(){return this._container},getOffset:function(){return this._tileCoord.scaleBy(this._size).subtract(this._map.getPixelOrigin())},onAdd:L.Util.falseFn,addTo:function(t){this._map=t},removeFrom:function(t){delete this._map},_onClick:function(t){var e,i,r=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());for(var n in this._layers)e=this._layers[n],e.options.interactive&&e._containsPoint(r)&&!this._map._draggableMoved(e)&&(i=e);i&&(L.DomEvent.fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t).subtract(this.getOffset());this._handleMouseHover(t,e)}},_updateIcon:function(t){if(this._drawing){var e=t.options.icon,i=e.options,r=L.point(i.iconSize),n=i.iconAnchor||r&&r.divideBy(2,!0),o=t._point.subtract(n),s=this._ctx,a=t._getImage();a.complete?s.drawImage(a,o.x,o.y,r.x,r.y):L.DomEvent.on(a,"load",function(){s.drawImage(a,o.x,o.y,r.x,r.y)}),this._drawnLayers[t._leaflet_id]=t}}}),L.canvas.tile=function(t,e,i){return new L.Canvas.Tile(t,e,i)}});
